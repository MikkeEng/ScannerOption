<!DOCTYPE html>
<html>
<head>
    <!-- <meta http-equiv="refresh" content="0; URL='url'" /> -->
    <meta http-equiv='Content-Type' content='text/html; charset=utf-8' scheme="file"/>
    <link rel="stylesheet" href="jquery.mobile-1.3.2.min.css">
    <script src="jquery-1.8.3.min.js"></script>
    <script src="jquery.mobile-1.3.2.min.js"></script>
    <style>

    </style>
</head>
<body onload="comprobar()">

<audio id="id_beepError">
    <source src="beepError.wav" type="audio/wav">
    Your browser does not support the audio element.
</audio>
<audio id="id_beepOk">
    <source src="beepOk.wav" type="audio/wav">
    Your browser does not support the audio element.
</audio>

<div data-role="page" id="pageone">
    <div data-role="header">
        <h1>MENU ESCANER</h1>
    </div>

    <div data-role="content">
        <form name="form1" method="get" action="">

            <div data-role="fieldcontain">
                <input class="number" type="number" name="name_keytext" id="id_keytext" value=""
                       autocomplete="off" onfocus="scanBarcode()">
                <label id="id_text"></label>
            </div>

            <div data-role="ui-field-contain">
                <input type="button" value="Comprobar" id="id_btnTest" onclick="comprobar()"/>
                <input type="button" value="Cancelar" id="id_btnCancel" onclick="cancelar()"/>
            </div>

            <!-- <div data-role="ui-field-contain">
                <input type="button" value="Volver" id="id_btnVolver" onclick="volver()"/>
            </div> -->
        </form>
    </div>
</div>

<script type="text/javascript">	

			var prueba = 1646265651114;
			
			function getParameterByName(name) {
				name = name.replace(/[\[]/, "\\[").replace(/[\]]/, "\\]");
				var regex = new RegExp("[\\?&]" + name + "=([^&#]*)"),
				results = regex.exec(location.search);
				return results === null ? "" : decodeURIComponent(results[1].replace(/\+/g, " "));
			}

			function testCode(){
				console.log("testCode()valor: " + document.getElementById("id_keytext").value)
				if(document.getElementById("id_keytext").value == ""){
					document.getElementById("id_text").innerHTML = "Escanea o escribe el valor";
				}else{
					var valor = getParameterByName('value');
					document.getElementById("id_keytext").value = valor;
					document.getElementById("id_text").innerHTML = "Comprueba el codigo";				
				}
			}

			function comprobar(){
				document.getElementById("divBorrar").style.display = "none";
				var valor = getParameterByName('value');
				document.getElementById("id_keytext").value = valor;
				console.log("Parametro $GET: " + valor);
				if(valor != "errorScan"){
					console.log("comprobar()valor: " + valor);
					console.log("comprobar()prueba: " + prueba);
					document.getElementById("id_text").innerHTML = "Comprueba el codigo";	
					if(valor == prueba){	
						window.open("scannerOK.html?value="+valor,"OK",
						"location=no,menubar=no,titlebar=no,resizable=no,toolbar=no,menubar=no");
					}else{
						document.getElementById("id_beepError").play();
						document.getElementById("id_text").innerHTML = "Error en el codigo. Vuelve a intentarlo";
						var speech = document.getElementById("id_text").innerHTML;
						Android.textSpeech(speech);
						showAndroidToast("Error con el codigo introducido");					
					}
				}else{
					document.getElementById("id_beepError").play();
					document.getElementById("id_text").innerHTML = "Posici√≥n incorrecta. Vete a posicion AA";
				    var speech = document.getElementById("id_text").innerHTML;
				    Android.textSpeech(speech);
					showAndroidToast("Error al introducir el codigo");
					document.getElementById("id_keytext").value = "";
				}
			}

            function cancelar() {
				if(document.getElementById("id_keytext").value != ""){
					console.log("cancelar(): Hay valor");
					document.getElementById("id_beepError").play();
					showAndroidToast("Valor borrado");
					document.getElementById("id_keytext").value = "";
				}else if(history.length){
					console.log("cancelar(): Ventana con historia")
					open(location, '_self').close();
				}else{
					console.log("cancelar(): Ventana sin historia")
					open(location, '_self').close();	
				}
            }

            function volver() {
				open(location, '_self').close();		
            }

            function scanBarcode() {
                Android.scanBarcode()
            }

            function textSpeech(texto){
                Android.textSpeech(texto)
            }

            function showAndroidToast(message) {
                Android.makeToastAndroid(message)
            }

            function autoFocusScan(){
            if(!("autofocus" in document.createElement("input")))
                document.getElementById("id_scan").focus();
                Android.scanBarcode()
            }

            $.mobile.pushStateEnabled = false




</script>

</body>
</html>